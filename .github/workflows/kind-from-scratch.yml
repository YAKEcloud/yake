name: "From Scratch"
on:
  pull_request:
jobs:
  ci:
    name: "23ke setup-kind & check-ci"
    runs-on: self-hosted
    steps:
      - uses: actions/checkout@v2.3.4
      - name: Set ENV
        run: ./hack/ci/github-setup-env.sh >> $GITHUB_ENV
      - uses: cachix/install-nix-action@v13
        with:
          nix_path: nixpkgs=channel:nixos-20.09
      - run: nix-shell --command "kind delete cluster --name ci-${BRANCH_NAME}"
      - run: nix-shell --command "hack/ci/setup-ci.sh ci-${BRANCH_NAME}"
      - run: nix-shell --command "hack/ci/test-ci.sh ci-${BRANCH_NAME}"
