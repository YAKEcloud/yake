name: "Shoot from Scratch"
on:
  push:
    branches:
      - feat/testing-on-shoot
jobs:
  ci:
    name: "23ke setup-shoot & check-ci"
    steps:
      - name: Checkout source
        uses: actions/checkout@v2.3.4
        with: 
          fetch-depth: 0
      - name: Set ENV
        run: ./hack/ci/github-setup-env.sh >> $GITHUB_ENV
      - name: Install nix packages
        uses: cachix/install-nix-action@v13
        with:
          nix_path: nixpkgs=channel:nixos-20.09
      - name: Setup Shoot
        run: nix-shell --command 'echo "$KUBECONFIG_CONTENT" > .github/gardener-kubeconfig.yaml; bash hack/setup-shoot.sh'
        env:
          KUBECONFIG_CONTENT: ${{ secrets.GARDENER_APISERVER_KUBECONFIG }}
      - name: Delete Shoot
        run: nix-shell --command 'bash hack/delete-shoot.sh'
