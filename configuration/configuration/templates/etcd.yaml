apiVersion: v1
kind: Secret
metadata:
  name: etcd-base-values
  namespace: flux-system
type: Opaque
stringData:
  values.yaml: |-
  {{- if .Values.registryOverwrite }}
        etcd:
          image:
            repository: {{ include "replaceRegistry" (dict "europe-docker.pkg.dev/gardener-project/public/gardener/etcd" .Values.registryOverwrite) }}
        etcd-backup-restore:
          image:
            repository: {{ include "replaceRegistry" (dict "europe-docker.pkg.dev/gardener-project/public/gardener/etcdbrctl" .Values.registryOverwrite) }}
{{- end }}
{{- if .Values.backups.enabled }}
{{- if eq .Values.backups.provider "azure" }}
        backup:
          storageProvider: ABS
          secretData:
            storageAccount: {{ .Values.backups.credentials.storageAccount }}
            storageKey: {{ .Values.backups.credentials.storageAccountAccessKey }}
          storageContainer: {{ .Values.backups.bucketName }}
{{- end }}
{{- if eq .Values.backups.provider "aws" }}
        backup:
          storageProvider: S3
          secretData:
            region: {{ .Values.backups.region }}
            accessKeyId: {{ .Values.backups.credentials.accessKeyID }}
            secretAccessKey: {{ .Values.backups.credentials.secretAccessKey }}
          storageContainer: {{ .Values.backups.bucketName }}
{{- end }}
{{- if eq .Values.backups.provider "openstack" }}
        backup:
          storageProvider: Swift
          secretData:
            authUrl: {{ .Values.backups.credentials.authURL }}
            password: {{ .Values.backups.credentials.password }}
            username: {{ .Values.backups.credentials.username }}
            projectName: {{ .Values.backups.credentials.tenantName }}
            regionName: {{ .Values.backups.credentials.region }}
            domainName: {{ .Values.backups.credentials.domainName }}
          storageContainer: {{ .Values.backups.bucketName }}
{{- end }}
{{- end }}
