{{- $secrets := dict }}
{{- $sec := lookup "v1" "Secret" "flux-system" "23ke-generated-secrets" }}
{{- if or $sec $sec.data }}
{{- $secrets = (index $sec.data "values.yaml") | b64dec | fromYaml }}
{{- end }}

apiVersion: v1
kind: Secret
metadata:
  name: 23ke-generated-secrets
  namespace: flux-system
stringData:
  values.yaml: |
    dashboard:
      sessionSecret: {{ ((($secrets).dashboard).sessionSecret) | default (randAlphaNum 20) }}
      clientSecret: {{ ((($secrets).dashboard).clientSecret) | default (randAlphaNum 20) }}
    kubeAPIServer:
      staticTokens:
        healthCheck: {{ (((($secrets).kubeAPIServer).staticTokens).healthCheck) | default (randAlphaNum 20) }}
type: Opaque
