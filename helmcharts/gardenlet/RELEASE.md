# [gardener]
## ⚠️ Breaking Changes
* *[OPERATOR]* The field `.spec.secretRef` in the `Seed` API has been deprecated and will be removed in a future release of Gardener. ([gardener/gardener#8064](https://github.com/gardener/gardener/pull/8064), [@acumino](https://github.com/acumino))
* *[OPERATOR]* Before upgrading to this gardener version, operators should configure `gardener-apiserver` to encrypt the `internalsecrets.core.gardener.cloud` resource in etcd. ([gardener/gardener#8078](https://github.com/gardener/gardener/pull/8078), [@timebertt](https://github.com/timebertt))
* *[OPERATOR]* The GA-ed feature gates `SeedChange` and `CopyEtcdBackupsDuringControlPlaneMigration` have been removed. ([gardener/gardener#8008](https://github.com/gardener/gardener/pull/8008), [@rfranzke](https://github.com/rfranzke))
* *[OPERATOR]* The feature gates `FullNetworkPolicies` and `HAControlPlanes` have been promoted to GA and are now locked to "unconditionally enabled". ([gardener/gardener#8008](https://github.com/gardener/gardener/pull/8008), [@rfranzke](https://github.com/rfranzke))
* *[OPERATOR]* The deprecated feature gate `APIServerSNI` has been removed. ([gardener/gardener#8062](https://github.com/gardener/gardener/pull/8062), [@rfranzke](https://github.com/rfranzke))
* *[DEVELOPER]* Functions `controllerutils.GetAndCreateOrMergePatch`, `controllerutils.GetAndCreateOrStrategicMergePatch`, `controllerutils.CreateOrGetAndMergePatch` and `controllerutils.CreateOrGetAndStrategicMergePatch` were incompatibly changed and now accept a `controllerutils.PatchOption` instead of `client.MergeFromOption`. ([gardener/gardener#8043](https://github.com/gardener/gardener/pull/8043), [@timuthy](https://github.com/timuthy))
  * If your controllers use one of these functions with `client.MergeFromOption`, you should update it to `controllerutils.PatchOption`.
  * The `controllerutils.PatchOption` can hold two options today:
  * `client.MergeFromOption` which is passed to the underlying patch function.
  * `controllerutils.SkipEmptyPatch` which prevents sending empty patches (`{}`).
## ✨ New Features
* *[OPERATOR]* A new alpha feature gate `DisableScalingClassesForShoots` has been introduced on `gardenlet`. If turned on, initial resource requests for `kube-apiserver`s of shoot clusters running on seed clusters which enable the `HVPA` feature gate are assigned statically and no longer by a scaling class determined by maximum node count. This helps to reduce resource waste for clusters with little usage. ([gardener/gardener#8003](https://github.com/gardener/gardener/pull/8003), [@voelzmo](https://github.com/voelzmo))
* *[OPERATOR]* A new alpha feature gate named `MachineControllerManagerDeployment` has been introduced in `gardenlet`. Only enable it when all registered provider extensions in your landscape support this feature. ([gardener/gardener#8018](https://github.com/gardener/gardener/pull/8018), [@rfranzke](https://github.com/rfranzke))
* *[OPERATOR]* gardener-apiserver now exposes a new `core.gardener.cloud/v1beta1.InternalSecret` API, see the [documentation](https://github.com/gardener/gardener/blob/master/docs/concepts/apiserver.md#internalsecrets) for more information. ([gardener/gardener#8025](https://github.com/gardener/gardener/pull/8025), [@timebertt](https://github.com/timebertt))
* *[OPERATOR]* The `gardenlet`'s `ManagedSeed` controller now cleans up the referred seed secret when `.spec.secretRef` is unset in the seed template. ([gardener/gardener#8039](https://github.com/gardener/gardener/pull/8039), [@shafeeqes](https://github.com/shafeeqes))
* *[DEVELOPER]* It is now easier to annotate `Service`s related to extensions serving webhook handlers that must be reached by `kube-apiserver`s running in separate namespaces such that the respective network traffic gets allowed. Please refer to [this guide](https://github.com/gardener/gardener/blob/master/docs/usage/network_policies.md#webhook-servers) for all information. Extensions serving shoot webhook should make use of this new approach - the old functionality deploying dedicated `NetworkPolicy`s is deprecated and will be removed in the future. ([gardener/gardener#8076](https://github.com/gardener/gardener/pull/8076), [@rfranzke](https://github.com/rfranzke))
* *[DEVELOPER]* `gardenlet`'s `ControllerInstallation` controller now populates the feature gate of `gardenlet` via the Helm values to extensions when they are getting installed. The information is populated via the `.gardener.gardenlet.featureGates` key. It contains a map whose keys are feature gates names and whose values are booleans (depicting the enablement status). ([gardener/gardener#8011](https://github.com/gardener/gardener/pull/8011), [@rfranzke](https://github.com/rfranzke))
* *[DEVELOPER]* Provider extensions should be adapted such that they only inject their provider-specific `machine-controller-manager` sidecar container into the `machine-controller-manager` deployment instead of managing the full deployment themselves. In the future, `gardenlet` will take over managing it. Please see https://github.com/gardener/gardener/pull/8019 for an example how `provider-local` was adapted and replicate it for your provider extensions. ([gardener/gardener#8018](https://github.com/gardener/gardener/pull/8018), [@rfranzke](https://github.com/rfranzke))
* *[DEVELOPER]* Provider extensions should be adapted such that they no longer perform health checks specific to the `machine-controller-manager` deployment or the machines/nodes. In the future, `gardenlet` will take over performing these checks. Please see https://github.com/gardener/gardener/pull/8019 for an example how `provider-local` was adapted and replicate it for your provider extensions. ([gardener/gardener#8056](https://github.com/gardener/gardener/pull/8056), [@rfranzke](https://github.com/rfranzke))
## 🐛 Bug Fixes
* *[USER]* A bug causing the shoot provider label in the infrastructure secret to not get cleaned up is now fixed. ([gardener/gardener#7994](https://github.com/gardener/gardener/pull/7994), [@shafeeqes](https://github.com/shafeeqes))
* *[USER]* Webhooks remediator sets the timeoutSeonds to 3 seconds for webhook affecting lease resources in `kube-system` namespace only if there is no objectSelector provided in webhook. ([gardener/gardener#8034](https://github.com/gardener/gardener/pull/8034), [@acumino](https://github.com/acumino))
* *[OPERATOR]* A bug has been fixed in the `garden/fluent-bit` that caused a failure in creating `networkpolicies` for scraping metrics. ([gardener/gardener#8069](https://github.com/gardener/gardener/pull/8069), [@timuthy](https://github.com/timuthy))
* *[OPERATOR]* A bug has been fixed in the [HighAvailabilityConfig-Webhook](https://github.com/gardener/gardener/blob/master/docs/concepts/resource-manager.md#high-availability-config) which caused duplicated entries for zone affinities. ([gardener/gardener#8042](https://github.com/gardener/gardener/pull/8042), [@timuthy](https://github.com/timuthy))
* *[OPERATOR]* The `terraformer` library will now skip deletion of the Terraformer pod when the request context has been canceled. This change aims to prevent inconsistencies in Terraform state by attempting to allow uninterrupted execution of healthy Terraformer pods. ([gardener/gardener#8059](https://github.com/gardener/gardener/pull/8059), [@kon-angelo](https://github.com/kon-angelo))
* *[DEVELOPER]* `pkg/resourcemanager/controller/garbagecollector/references.InjectAnnotations` now also handles `pods.spec.imagePullSecrets`. ([gardener/gardener#8028](https://github.com/gardener/gardener/pull/8028), [@vpnachev](https://github.com/vpnachev))
## 🏃 Others
* *[OPERATOR]* The shoot namespace in seeds is redeployed during shoot deletion to update the zones in use. ([gardener/gardener#8079](https://github.com/gardener/gardener/pull/8079), [@timuthy](https://github.com/timuthy))
* *[OPERATOR]* `nginx-ingress-controller-seed` image is updated to `v1.8.0` for `1.24.x+` seeds. ([gardener/gardener#8021](https://github.com/gardener/gardener/pull/8021), [@shafeeqes](https://github.com/shafeeqes))
* *[OPERATOR]* The following image is updated: ([gardener/gardener#8029](https://github.com/gardener/gardener/pull/8029), [@nickytd](https://github.com/nickytd))
  * quay.io/brancz/kube-rbac-proxy: v0.14.0 -> v0.14.2
* *[OPERATOR]* The worker count for the [NetworkPolicy controller](https://github.com/gardener/gardener/blob/master/docs/concepts/resource-manager.md#networkpolicy-controller) in GRM was increased to `20`. This is necessary to create and update `NetworkPolicies` in time, esp. on larger seed clusters. ([gardener/gardener#8035](https://github.com/gardener/gardener/pull/8035), [@timuthy](https://github.com/timuthy))
* *[DEVELOPER]* `gardenlet` is taking over management of the `CustomResourceDefinition`s for the `machine.sapcloud.io/v1alpha1` API group, hence extensions do no longer need to take care. Consequently, the `extensions/pkg/controller/worker.Options` struct as well as the `extensions/pkg/controller/worker.ApplyMachineResources{ForConfig}` functions are deprecated and will be removed in a future release. ([gardener/gardener#8015](https://github.com/gardener/gardener/pull/8015), [@rfranzke](https://github.com/rfranzke))
* *[DEVELOPER]* Go version is updated to 1.20.5. ([gardener/gardener#8037](https://github.com/gardener/gardener/pull/8037), [@shafeeqes](https://github.com/shafeeqes))
* *[DEVELOPER]* The kind clusters are now unified to use `garden.local.gardener.cloud` DNS name in the containerd config when configuring registry mirror hostnames. Previously, to access the pull through registry cache some kind clusters were configured to use `garden.local.gardener.cloud`, others - the Node name of the control plane Node. ([gardener/gardener#8063](https://github.com/gardener/gardener/pull/8063), [@ialidzhikov](https://github.com/ialidzhikov))