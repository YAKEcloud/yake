apiVersion: v1
kind: Pod
metadata:
  name: {{ .Release.Name }}-test-provider
  namespace: flux-system
  annotations:
    "helm.sh/hook": test
spec:
  containers:
    - name: test-dnsprovider
      image: bitnami/kubectl
      command: ['bash', '-c']
      args:
        - |
          state=$(kubectl get dnsproviders.dns.gardener.cloud -n garden base-dns-provider -o jsonpath='{.status.state}')
          if [[ $state != "Ready" ]]; then
            echo "Your dnsprovider is not ready. Please check the credentials provided in the 23ke-config secret."
            echo ""
            kubectl get dnsproviders.dns.gardener.cloud -n garden base-dns-provider -o jsonpath='{.status.message}'
            echo ""
            exit 1
          fi
          exit 0
  restartPolicy: Never
